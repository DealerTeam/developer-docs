@isTest
private class Test_ADFClasses {
	@isTest
	static void testADFParsing() {
		
		String testADFData = '<?xml version="1.0"?> <?ADF version="1.0.1"?> <adf> <prospect status="new"> <id source="FordDirect">30822086</id> <requestdate>2012-05-28T19:17:27</requestdate> <vehicle interest="buy" status="new"> <year>2012</year> <make>Ford</make> <model>F-350</model> <vin></vin> <stock></stock> <trim></trim> <doors></doors> <bodystyle>F-350</bodystyle> <transmission>TorqShiftÂ® 6-Speed SelectShift&amp;#153; Automatic O/D w/6.7L</transmission> <odometer></odometer> <colorcombination> <interiorcolor>Black</interiorcolor> <exteriorcolor>Sterling Gray Clearcoat Metallic</exteriorcolor> <preference>1</preference> </colorcombination> <option> <optionname>SiriusXM Satellite Radio</optionname> <manufacturercode>39S</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>SYNC AppLink</optionname> <manufacturercode>91M</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>18 6-Spoke Cast Aluminum Wheels </optionname> <manufacturercode>64C</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Non-Fleet</optionname> <manufacturercode>NFLEET</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Tough Bed#174;</optionname> <manufacturercode>85S</manufacturercode> <price type="quote" source="MSRP">450.0</price> </option> <option> <optionname>Power Sliding Rear Window with Privacy Glass and Defrost</optionname> <manufacturercode>435</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>All-Weather Floor Mats</optionname> <manufacturercode>16S</manufacturercode> <price type="quote" source="MSRP">75.0</price> </option> <option> <optionname>Bodyside Molding</optionname> <manufacturercode>965</manufacturercode> <price type="quote" source="MSRP">60.0</price> </option> <option> <optionname>5th Wheel/Gooseneck Hitch Prep Package</optionname> <manufacturercode>53W</manufacturercode> <price type="quote" source="MSRP">370.0</price> </option> <option> <optionname>4X4 Electronic-Shift-On-the-Fly</optionname> <manufacturercode>213</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Skid Plates, Transfer Case Fuel Tank</optionname> <manufacturercode>41P</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Reverse Vehicle Aid Sensor</optionname> <manufacturercode>76R</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Extra Heavy Duty Alternator</optionname> <manufacturercode>67D</manufacturercode> <price type="quote" source="MSRP">75.0</price> </option> <option> <optionname>Upfitter Switches (4) - Located on Instrument Panel</optionname> <manufacturercode>66S</manufacturercode> <price type="quote" source="MSRP">125.0</price> </option> <option> <optionname>Trailer Brake Controller</optionname> <manufacturercode>52B</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>NONE</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Cargo Tie-Down Hooks - Inside</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>LOAD BOX EDGE PROTECTORS</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>B5WAT</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>bldae</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>C1UAB</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Body Colored Door Handles</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Two Key Fobs</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Rancho Branded Shocks ? Colored Front and Rear Shocks</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Bright Chrome Hub Covers and Center Ornaments</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Leather-Wrapped Steering Wheel with SYNC#174; Controls</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Autolamp/Rainlamp</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Chrome Front Bumper</optionname> <manufacturercode>CLFAE</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Chrome Rear Bumper</optionname> <manufacturercode>CLMAE</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>618A</optionname> <manufacturercode>618A</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>6-3/4 ft</optionname> <manufacturercode>CBB</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>6.7L Power Stroke(R) V8 Turbo Diesel Engine</optionname> <manufacturercode>99T</manufacturercode> <price type="quote" source="MSRP">7960.0</price> </option> <option> <optionname>FX4 Off Road Decal</optionname> <manufacturercode>GA4</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Lariat</optionname> <manufacturercode>AA2</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>3.31 Electronic Locking Axle Ratio</optionname> <manufacturercode>X3H</manufacturercode> <price type="quote" source="MSRP">390.0</price> </option> <option> <optionname>18 Black Side Wall All-Terrain (4), 4x4 (spare tire all-terrain)</optionname> <manufacturercode>TDX</manufacturercode> <price type="quote" source="MSRP">125.0</price> </option> <option> <optionname>SuperCab</optionname> <manufacturercode>SEC</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>50 State Emissions System</optionname> <manufacturercode>425</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Chrome Grille/Bumpers</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Locking Removable Tailgate w/Lift Assist</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Power Sliding Rear Window</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Spare Tire Wheel Lock</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Front Tow Hooks/Fog Lamps</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Power Windows/Locks</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Powerscope TT Mirrors</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Reverse Vehicle Aid Sensor</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Trailer Brake Controller</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>AM/FM Single CD/MP3 Player</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Color Coord Carpet Mats</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Electrochromic Mirror</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Leather Steering Wheel w/Audio Controls</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Rear Fold-Up Bench Seat</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>SIRIUS SAT Radio N/A AK/HI</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>10-Way Power Driver/Passenger Seats</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Dual Electronic Automatic Temperature Control</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>SYNC Voice Activated System</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Autolamp/Rainlamp</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Autolock/Unlock</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Driver/Passenger Air Bags</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Securicode Keyless Keypad</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>4-Wheel Antilock Brake System</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Remote Keyless Entry w/Alarm</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Trailer Towing Package</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Mono Beam Coil Spring Suspension w/Stabilizer Bar</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Securilock Anti Theft Ignition</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>3YR/36,000 Bumper / Bumper</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>5YR/60,000 Powertrain</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>5YR/60,000 Roadside Assist</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Power Scope(TM) Trailer Tow Mirrors</optionname> <manufacturercode>54F</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Retail</optionname> <manufacturercode>RET</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>142</optionname> <manufacturercode>142</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Premium Sound System</optionname> <manufacturercode>58S</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>F-350</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>4X4</optionname> <manufacturercode>4X4</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Front Premium Leather Seating Surfaces 40/Console/40; 10-Way Power and Driver Passenger Seating with Matching 60/40 Rear Bench with Partitioned Locking Under Seat Storage and 12V Powerpoint</optionname> <manufacturercode>885</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Lariat</optionname> <manufacturercode>LAT</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Super Cab SRW 4X4</optionname> <manufacturercode>X3B</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Premium Leather</optionname> <manufacturercode>LEA</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>FX4 4X4 Off Road Package</optionname> <manufacturercode>17X</manufacturercode> <price type="quote" source="MSRP">295.0</price> </option> <option> <optionname>Power Equipment Group</optionname> <manufacturercode>90L</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Single Rear Wheels</optionname> <manufacturercode>SRW</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Lariat 4x4 Supercab SRW 6 3/4 FT Box</optionname> <manufacturercode>2012 X3B FORD</manufacturercode> <price type="quote" source="MSRP">44040.0</price> </option> <finance> <method>Loan</method> <amount/> </finance> </vehicle> <customer> <contact primarycontact="1"> <name type="individual" part="first">Brimhall</name> <name type="individual" part="last">Peter</name> <email>pbrimhall@hotmail.com</email> <phone type="voice" time="evening">5309174932</phone> <phone type="voice" time="day"></phone> <phone type="cellphone"></phone> <address type="home"> <street line="1">2209 Terrace St.</street> <street line="2"></street> <city>Redding </city> <regioncode>CA</regioncode> <postalcode>96001</postalcode> </address> </contact> <timeframe> <description>Immediately</description> </timeframe> <comments>https://www.dashboard.dealerconnection.com/Leads/Details?LeadId=30822086 , PlanType:MSRP Segmentation analysis suggests this consumer is likely: Moderate Income City Middle Aged Renters With and Without Children Average Income: $26,765 Average Age: 39.5 Percent Home Owners: 4% Percent with Children: 48% Please note: The segmentation information is not actual data about this consumer and should not be used as actual personal information for any reason.</comments> </customer> <vendor> <id source="FordDirect">00602</id> <vendorname>Crown Ford</vendorname> <contact> <name type="business" part="full">Crown Ford</name> <phone type="voice">(866) 346-9426</phone> <address> <street line="1">555 West Cypress</street> <city>Redding</city> <regioncode>CA</regioncode> <postalcode>96001</postalcode> </address> </contact> </vendor> <provider> <name type="business" part="full">FD</name> <service>Ford Direct - Lead</service> <url>http://www.FordDirect.com</url> </provider> </prospect> </adf>';
		
		String testADFData1 = '<?xml version="1.0"?> <?ADF version="1.0.1"?> <adf> <prospect status="new"> <id source="FordDirect">30822087</id> <requestdate>2012-05-28T19:17:27</requestdate> <vehicle interest="buy" status="new"> <year>2012</year> <make>Ford</make> <model>F-350</model> <vin></vin> <stock></stock> <trim></trim> <doors></doors> <bodystyle>F-350</bodystyle> <transmission>TorqShiftÂ® 6-Speed SelectShift&amp;#153; Automatic O/D w/6.7L</transmission> <odometer></odometer> <colorcombination> <interiorcolor>Black</interiorcolor> <exteriorcolor>Sterling Gray Clearcoat Metallic</exteriorcolor> <preference>1</preference> </colorcombination> <option> <optionname>SiriusXM Satellite Radio</optionname> <manufacturercode>39S</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>SYNC AppLink</optionname> <manufacturercode>91M</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>18 6-Spoke Cast Aluminum Wheels </optionname> <manufacturercode>64C</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Non-Fleet</optionname> <manufacturercode>NFLEET</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Tough Bed#174;</optionname> <manufacturercode>85S</manufacturercode> <price type="quote" source="MSRP">450.0</price> </option> <option> <optionname>Power Sliding Rear Window with Privacy Glass and Defrost</optionname> <manufacturercode>435</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>All-Weather Floor Mats</optionname> <manufacturercode>16S</manufacturercode> <price type="quote" source="MSRP">75.0</price> </option> <option> <optionname>Bodyside Molding</optionname> <manufacturercode>965</manufacturercode> <price type="quote" source="MSRP">60.0</price> </option> <option> <optionname>5th Wheel/Gooseneck Hitch Prep Package</optionname> <manufacturercode>53W</manufacturercode> <price type="quote" source="MSRP">370.0</price> </option> <option> <optionname>4X4 Electronic-Shift-On-the-Fly</optionname> <manufacturercode>213</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Skid Plates, Transfer Case Fuel Tank</optionname> <manufacturercode>41P</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Reverse Vehicle Aid Sensor</optionname> <manufacturercode>76R</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Extra Heavy Duty Alternator</optionname> <manufacturercode>67D</manufacturercode> <price type="quote" source="MSRP">75.0</price> </option> <option> <optionname>Upfitter Switches (4) - Located on Instrument Panel</optionname> <manufacturercode>66S</manufacturercode> <price type="quote" source="MSRP">125.0</price> </option> <option> <optionname>Trailer Brake Controller</optionname> <manufacturercode>52B</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>NONE</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Cargo Tie-Down Hooks - Inside</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>LOAD BOX EDGE PROTECTORS</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>B5WAT</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>bldae</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>C1UAB</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Body Colored Door Handles</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Two Key Fobs</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Rancho Branded Shocks ? Colored Front and Rear Shocks</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Bright Chrome Hub Covers and Center Ornaments</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Leather-Wrapped Steering Wheel with SYNC#174; Controls</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Autolamp/Rainlamp</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Chrome Front Bumper</optionname> <manufacturercode>CLFAE</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Chrome Rear Bumper</optionname> <manufacturercode>CLMAE</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>618A</optionname> <manufacturercode>618A</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>6-3/4 ft</optionname> <manufacturercode>CBB</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>6.7L Power Stroke(R) V8 Turbo Diesel Engine</optionname> <manufacturercode>99T</manufacturercode> <price type="quote" source="MSRP">7960.0</price> </option> <option> <optionname>FX4 Off Road Decal</optionname> <manufacturercode>GA4</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Lariat</optionname> <manufacturercode>AA2</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>3.31 Electronic Locking Axle Ratio</optionname> <manufacturercode>X3H</manufacturercode> <price type="quote" source="MSRP">390.0</price> </option> <option> <optionname>18 Black Side Wall All-Terrain (4), 4x4 (spare tire all-terrain)</optionname> <manufacturercode>TDX</manufacturercode> <price type="quote" source="MSRP">125.0</price> </option> <option> <optionname>SuperCab</optionname> <manufacturercode>SEC</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>50 State Emissions System</optionname> <manufacturercode>425</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Chrome Grille/Bumpers</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Locking Removable Tailgate w/Lift Assist</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Power Sliding Rear Window</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Spare Tire Wheel Lock</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Front Tow Hooks/Fog Lamps</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Power Windows/Locks</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Powerscope TT Mirrors</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Reverse Vehicle Aid Sensor</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Trailer Brake Controller</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>AM/FM Single CD/MP3 Player</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Color Coord Carpet Mats</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Electrochromic Mirror</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Leather Steering Wheel w/Audio Controls</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Rear Fold-Up Bench Seat</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>SIRIUS SAT Radio N/A AK/HI</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>10-Way Power Driver/Passenger Seats</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Dual Electronic Automatic Temperature Control</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>SYNC Voice Activated System</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Autolamp/Rainlamp</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Autolock/Unlock</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Driver/Passenger Air Bags</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Securicode Keyless Keypad</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>4-Wheel Antilock Brake System</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Remote Keyless Entry w/Alarm</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Trailer Towing Package</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Mono Beam Coil Spring Suspension w/Stabilizer Bar</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Securilock Anti Theft Ignition</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>3YR/36,000 Bumper / Bumper</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>5YR/60,000 Powertrain</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>5YR/60,000 Roadside Assist</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Power Scope(TM) Trailer Tow Mirrors</optionname> <manufacturercode>54F</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Retail</optionname> <manufacturercode>RET</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>142</optionname> <manufacturercode>142</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Premium Sound System</optionname> <manufacturercode>58S</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>F-350</optionname> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>4X4</optionname> <manufacturercode>4X4</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Front Premium Leather Seating Surfaces 40/Console/40; 10-Way Power and Driver Passenger Seating with Matching 60/40 Rear Bench with Partitioned Locking Under Seat Storage and 12V Powerpoint</optionname> <manufacturercode>885</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Lariat</optionname> <manufacturercode>LAT</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Super Cab SRW 4X4</optionname> <manufacturercode>X3B</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Premium Leather</optionname> <manufacturercode>LEA</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>FX4 4X4 Off Road Package</optionname> <manufacturercode>17X</manufacturercode> <price type="quote" source="MSRP">295.0</price> </option> <option> <optionname>Power Equipment Group</optionname> <manufacturercode>90L</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Single Rear Wheels</optionname> <manufacturercode>SRW</manufacturercode> <price type="quote" source="MSRP">0.0</price> </option> <option> <optionname>Lariat 4x4 Supercab SRW 6 3/4 FT Box</optionname> <manufacturercode>2012 X3B FORD</manufacturercode> <price type="quote" source="MSRP">44040.0</price> </option> <finance> <method>Loan</method> <amount/> </finance> </vehicle> <customer> <contact primarycontact="1"> <name type="individual" part="first">Brimhall</name> <name type="individual" part="last">Peter</name> <email>pbrimhall@hotmail.com</email> <phone type="voice" time="evening">5309174932</phone> <phone type="voice" time="day"></phone> <phone type="cellphone"></phone> <address type="home"> <street line="1">2209 Terrace St.</street> <street line="2"></street> <city>Redding </city> <regioncode>CA</regioncode> <postalcode>96001</postalcode> </address> </contact> <timeframe> <description>Immediately</description> </timeframe> <comments>https://www.dashboard.dealerconnection.com/Leads/Details?LeadId=30822086 , PlanType:MSRP Segmentation analysis suggests this consumer is likely: Moderate Income City Middle Aged Renters With and Without Children Average Income: $26,765 Average Age: 39.5 Percent Home Owners: 4% Percent with Children: 48% Please note: The segmentation information is not actual data about this consumer and should not be used as actual personal information for any reason.</comments> </customer> <vendor> <id source="FordDirect">00602</id> <vendorname>Crown Ford</vendorname> <contact> <name type="business" part="full">Crown Ford</name> <phone type="voice">(866) 346-9426</phone> <address> <street line="1">555 West Cypress</street> <city>Redding</city> <regioncode>CA</regioncode> <postalcode>96001</postalcode> </address> </contact> </vendor> <provider> <name type="business" part="full">FD</name> <service>Ford Direct - Lead</service> <url>http://www.FordDirect.com</url> </provider> </prospect> </adf>';

		String testADFData2 = '<?xml version="1.0"?> <?adf version="1.0"?> <adf> <prospect status="new"> <id sequence="1" source="Cars.com NewLeadsPlus">248308594</id> <requestdate>06/20/2012 01:09PM PST</requestdate> <vehicle interest="buy" status="new"> <year>2012</year> <make>Dodge</make> <model>Durango</model> <trim>SXT 4dr All-wheel Drive</trim> <colorcombination> <interiorcolor></interiorcolor> <exteriorcolor>UNDECIDED</exteriorcolor> <preference>1</preference> </colorcombination> </vehicle> <customer> <contact> <name part="first">Robert</name> <name part="last">Norris</name> <email >nsfrob1@yahoo.com</email> <phone type="voice" time="day" >(530)945-2234</phone> <address type="home"> <street line="1">4361 Caterpillar Rd</street> <city>Redding</city> <regioncode>CA</regioncode> <postalcode>96003</postalcode> <country>United States</country> </address> </contact> <comments>Lead Source: Other. Verified Method of Contact: E-mail.</comments> </customer> <vendor> <id sequence="1" source="Cars.com NewLeadsPlus">46757</id> <vendorname>Crown Motors</vendorname> <contact> <name part="full">Mark Alward</name> <phone type="voice">530-232-1234</phone> </contact> </vendor> <provider> <name part="full">Cars.com NewLeadsPlus</name> <service>Cars.com</service> <url>http://www.cars.com</url> <email>support@cars.com</email> <phone>(888)252-7731</phone> </provider> </prospect> </adf> ';

		String testADFData3 = '<?xml version="1.0" ?> <?adf version="1.0" ?> <adf> <prospect status="new"> <id sequence="1" source="NPM">9668470</id> <id sequence="2" source="Next Phase Media, Inc.">9668470</id> <requestdate>2012-06-21T07:47:01-07:00</requestdate> <vehicle interest="buy" status="new"> <year>2012</year> <make>Ford</make> <model>Focus</model> <trim>S</trim> <transmission></transmission> <colorcombination> <interiorcolor>no preference</interiorcolor> <exteriorcolor>no preference</exteriorcolor> <interiorcolorchoice2>no preference</interiorcolorchoice2> <exteriorcolorchoice2>no preference</exteriorcolorchoice2> <preference>1</preference> </colorcombination> <finance> <method></method> <amount>0.0</amount> </finance> </vehicle> <customer> <contact> <name part="first">warren</name> <name part="last">ferris</name> <email preferredcontact="1">lcfsfish@aol.com</email> <phone type="voice" time="evening" preferredcontact="0">5303473082</phone> <address> <street line="1">19938indian tom dr</street> <city>Cottonwood</city> <regioncode>CA</regioncode> <postalcode>96022</postalcode> <country>US</country> </address> </contact> <credithistory></credithistory> <timeframe></timeframe> <comments></comments> </customer> <vendor> <vendorname>Next Phase Media, Inc.</vendorname> </vendor> <provider> <name part="full">Next Phase Media, Inc.</name> </provider> </prospect> </adf> ';

		String testNoLastName = '<?xml version="1.0" encoding="utf-8" ?> <?adf version="1.0" ?> <adf> <prospect> <requestdate>2013-06-06T04:03:01.937</requestdate> <vehicle interest="buy" status="used"> <year>2011</year> <make>Subaru</make> <model>Forester</model> <vin></vin> <stock>T9168</stock> <trim>2.5X AWD</trim> <price type="quote" currency="USD">21499.0000</price> <comments>2011 SUBARU FORESTER 2.5X AWD... listed at http://www.recycler.com/Details/-39477475</comments> </vehicle> <customer> <contact> <name part="full">Lettow</name> <name part="first">Lettow</name> <name part="last"> </name> <postalcode>28715</postalcode> <phone type="voice">7206487144</phone> <email>lalettow@gmail.com</email> </contact> <comments> </comments> </customer> <vendor> <vendorname>Auto Advantage</vendorname> <contact> <email>autoadvantage@dealerteam.com</email> </contact> </vendor> <provider> <name part="full">Charter Media</name> <service>Charter Media</service> <url>http://www.recycler.com/</url> <email>partners@cfm.com</email> <phone>3239303123</phone> </provider> </prospect> </adf>';
		//String testNoLastName = '<?xml version="1.0" encoding="utf-8" ?> <?adf version="1.0" ?> <adf> <prospect> <requestdate>2013-06-06T04:03:01.937</requestdate> <vehicle interest="buy" status="used"> <year>2011</year> <make>Subaru</make> <model>Forester</model> <vin>JF2SHABC4BH777057</vin> <stock>T9168</stock> <trim>2.5X AWD</trim> <price type="quote" currency="USD">21499.0000</price> <comments>2011 SUBARU FORESTER 2.5X AWD... listed at http://www.recycler.com/Details/-39477475</comments> </vehicle> <customer> <contact> <name part="full">Lettow</name> <name part="first">Lettow</name> <name part="last"> </name> <postalcode>28715</postalcode> <phone type="voice">7206487144</phone> <email>lalettow@gmail.com</email> </contact> <comments> </comments> </customer> <vendor> <vendorname>Auto Advantage</vendorname> <contact> <email>autoadvantage@dealerteam.com</email> </contact> </vendor> <provider> <name part="full">Charter Media</name> <service>Charter Media</service> <url>http://www.recycler.com/</url> <email>partners@cfm.com</email> <phone>3239303123</phone> </provider> </prospect> </adf>';


		

		Test.startTest();

		ADFAPI controller = new ADFAPI();
		dealer__Sales_Up__c 	result 		=	controller.parseADF(testADFData, 'to@address.com', 'fromEmail@address.com');
		dealer__Sales_Up__c		resul23 	= 	controller.parseADF(testADFData1, 'auctiondirectinternetadx@dealerteam.com' , 'fromEmail@address.com');
	
		Test.stopTest();

	}


	@isTest
	static void testTrade() {


		String testTradeIn  = '<?xml version="1.0" encoding="utf-8" ?> <?adf version="1.0"?> <adf> <prospect status="new"> <id sequence="1" source="Veretech">1405985459</id> <requestdate>2014-01-31T10:58:53-05:00</requestdate> <vehicle interest="buy" status="used"> <year>2013</year> <make>BMW</make> <model>6-Series</model> <vin></vin> <stocknumber></stocknumber> <trim>2D Coupe</trim> <bodystyle /> <transmission /> <odometer units="mi" /> <colorcombination> <interiorcolor /> <exteriorcolor>UNDECIDED</exteriorcolor> <preference>1</preference> </colorcombination> <price type="quote" currency="USD" source="" /> <pricecomments /> <comments /> </vehicle> <vehicle interest="trade-in" status="used"> <year>2013</year> <make>Mercedes-Benz</make> <model>M Class</model> <vin /> <trim>ML350</trim> <bodystyle>4D Utility</bodystyle> <transmission /> <odometer units="mi">13300</odometer> <colorcombination> <interiorcolor /> <exteriorcolor>White</exteriorcolor> <preference>1</preference> </colorcombination> <price type="quote" currency="USD" source="BlackBookOnline" /> <pricecomments>Price Range: $36,710 - $42,680</pricecomments> <option><optionname>Navigation System</optionname><weighting>0</weighting></option> <option><optionname>Panorama Roof</optionname><weighting>0</weighting></option> <option><optionname>Rearview Camera System</optionname><weighting>0</weighting></option> <option><optionname>w/o Leather</optionname><weighting>0</weighting></option> <comments>Price Range: $36,710 - $42,680 CONDITION REPORT INFO: </comments> </vehicle> <customer> <contact> <name part="full" type="individual">Jason Schmidt</name> <email>dcfilm@aol.com</email> <phone time="morning" type="voice" preferredcontact="0">8082258082</phone> <phone time="evening" type="voice" preferredcontact="0" /> <address type="home"> <street line="1"></street> <street line="2" /> <apartment /> <city>Santa Ana</city> <regioncode>CA</regioncode> <postalcode>92707</postalcode> <country /> </address> </contact> <comments><![CDATA[ CLICK THIS LINK FOR TIPS ON HOW TO GET AN APPOINTMENT <a href="http://www.blackbookinsight.com/dealer">http://www.blackbookinsight.com/dealer </a>EST. TRADE VALUE: $36,710 - $42,680]]> </comments> </customer> <vendor> <id sequence="" source="BlackBookOnline"></id> <vendorname>Auction Direct USA - Jacksonville</vendorname> <contact> <name part="full" type="individual" /> <name part="first" type="individual" /> <name part="last" type="individual" /> <email /> <phone time="nopreference" type="voice" preferredcontact="0" /> <phone time="nopreference" type="voice" preferredcontact="0" /> <address type="home"> <street line="1">6400 Blanding Boulevard</street> <street line="2"></street> <apartment /> <city>Jacksonville</city> <regioncode>Florida</regioncode> <postalcode>32244</postalcode> <country /> </address> </contact> </vendor> <provider> <id sequence="1" source="BlackBookOnline">561</id> <name part="full" type="business">BlackBookOnline</name> <service>VER</service> <url>http://www.blackbookonline.com</url> <email>support@veretech.com</email> <phone>866-452-1400</phone> <contact> <name part="full" type="individual">Dealer Support</name> <name part="first" type="individual" /> <name part="last" type="individual" /> <email>support@veretech.com</email> <phone time="nopreference" type="voice" preferredcontact="0">866-452-1400</phone> <phone time="nopreference" type="fax" preferredcontact="0">561-544-1450</phone> <address type="work"> <street line="1">150 E. Palmetto Park Road</street> <street line="2">Suite 600</street> <apartment /> <city>Boca Raton</city> <regioncode>FL</regioncode> <postalcode>33432</postalcode> <country>USA</country> </address> </contact> </provider> </prospect> </adf>';

		ADFAPI adfP2 = new ADFAPI();
		dealer__Sales_Up__c[] sup = [Select Id, OwnerID from dealer__Sales_Up__c limit 1];
		
		dealer__Sales_Up__c resultTradeIn	=	adfP2.parseADF(testTradeIn, 'to@address.com', 'fromEmail@address.com');


	}

	@isTest
	static void testTradeAgain() {

		String testTradeIn1  = '<?xml version="1.0" encoding="utf-8" ?> <?adf version="1.0"?> <adf> <prospect status="new"> <id sequence="1" source="Veretech">1405985457</id> <requestdate>2014-01-31T10:58:53-05:00</requestdate> <vehicle interest="buy" status="used"> <year>2013</year> <make>BMW</make> <model>6-Series</model> <vin></vin> <stocknumber></stocknumber> <trim>2D Coupe</trim> <bodystyle /> <transmission /> <odometer units="mi" /> <colorcombination> <interiorcolor /> <exteriorcolor>UNDECIDED</exteriorcolor> <preference>1</preference> </colorcombination> <price type="quote" currency="USD" source="" /> <pricecomments /> <comments /> </vehicle> <vehicle interest="trade-in" status="used"> <year>2013</year> <make>Mercedes-Benz</make> <model>M Class</model> <vin /> <trim>ML350</trim> <bodystyle>4D Utility</bodystyle> <transmission /> <odometer units="mi">13300</odometer> <colorcombination> <interiorcolor /> <exteriorcolor>White</exteriorcolor> <preference>1</preference> </colorcombination> <price type="quote" currency="USD" source="BlackBookOnline" /> <pricecomments>Price Range: $36,710 - $42,680</pricecomments> <option><optionname>Navigation System</optionname><weighting>0</weighting></option> <option><optionname>Panorama Roof</optionname><weighting>0</weighting></option> <option><optionname>Rearview Camera System</optionname><weighting>0</weighting></option> <option><optionname>w/o Leather</optionname><weighting>0</weighting></option> <comments>Price Range: $36,710 - $42,680 CONDITION REPORT INFO: </comments> </vehicle> <customer> <contact> <name part="full" type="individual">Jason Schmidt</name> <email>dcfilm@aol.com</email> <phone time="morning" type="voice" preferredcontact="0">8082258082</phone> <phone time="evening" type="voice" preferredcontact="0" /> <address type="home"> <street line="1"></street> <street line="2" /> <apartment /> <city>Santa Ana</city> <regioncode>CA</regioncode> <postalcode>92707</postalcode> <country /> </address> </contact> <comments><![CDATA[ CLICK THIS LINK FOR TIPS ON HOW TO GET AN APPOINTMENT <a href="http://www.blackbookinsight.com/dealer">http://www.blackbookinsight.com/dealer </a>EST. TRADE VALUE: $36,710 - $42,680]]> </comments> </customer> <vendor> <id sequence="" source="BlackBookOnline"></id> <vendorname>Auction Direct USA - Jacksonville</vendorname> <contact> <name part="full" type="individual" /> <name part="first" type="individual" /> <name part="last" type="individual" /> <email /> <phone time="nopreference" type="voice" preferredcontact="0" /> <phone time="nopreference" type="voice" preferredcontact="0" /> <address type="home"> <street line="1">6400 Blanding Boulevard</street> <street line="2"></street> <apartment /> <city>Jacksonville</city> <regioncode>Florida</regioncode> <postalcode>32244</postalcode> <country /> </address> </contact> </vendor> <provider> <id sequence="1" source="BlackBookOnline">561</id> <name part="full" type="business">BlackBookOnline</name> <service>VER</service> <url>http://www.blackbookonline.com</url> <email>support@veretech.com</email> <phone>866-452-1400</phone> <contact> <name part="full" type="individual">Dealer Support</name> <name part="first" type="individual" /> <name part="last" type="individual" /> <email>support@veretech.com</email> <phone time="nopreference" type="voice" preferredcontact="0">866-452-1400</phone> <phone time="nopreference" type="fax" preferredcontact="0">561-544-1450</phone> <address type="work"> <street line="1">150 E. Palmetto Park Road</street> <street line="2">Suite 600</street> <apartment /> <city>Boca Raton</city> <regioncode>FL</regioncode> <postalcode>33432</postalcode> <country>USA</country> </address> </contact> </provider> </prospect> </adf>';

		Test.startTest();
		ADFAPI adfP3 = new ADFAPI();
		dealer__CRMSettings__c crm = dealer__CRMSettings__c.getInstance();
		crm.dealer__ILM_No_Duplicates__c=true;
		dealer__Sales_Up__c adf3Res			=	adfP3.parseADF(testTradeIn1, 'to@address.com', 'fromEmail@address.com');		
		Test.stopTest();

	}

	@isTest
	static void testBadXML() {
		// Test Bad XML
		String badXML = 'nothing here to parse';
		ADFAPI adfBad = new ADFAPI();
		dealer__Sales_Up__c badResult= adfBad.parseADF(badXML, 'to@address.com', 'from@address.com');
	}


	@isTest
	static void testADFVoiceParser() {
		String testCallADF = '<?xml version="1.0"?> <inboundCall xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" version="1.08" eventName="ConversationEnds" eventHappenedOn="2013-05-17T21:08:34Z" xmlns="http://www.callbright.com/InboundCallCrm"> <call> <id>20130517140735-vs7-494</id> <callStart>2013-05-17T21:07:35Z</callStart> <callEnd>2013-05-17T21:08:31Z</callEnd> <callDuration>1.00</callDuration> <conversationStart>2013-05-17T21:07:46Z</conversationStart> <conversationEnd>2013-05-17T21:08:30Z</conversationEnd> <conversationDuration>0.7</conversationDuration> <profileLink>http://admin.callbright.com/callbrightDetails/detailsPage.aspx?passcode=PRISS3XJ4KXHROu6YKiwM~3sQxlf-8J</profileLink> <terminationCause>Agent</terminationCause> <inboundLeadTrackerInformation /> <webReference /> <service>Inbound</service> <followUpCode /> </call> <caller> <id>5852336929</id> <phoneType>Unavailable</phoneType> <fullName>Private Caller</fullName> <firstName>Private</firstName> <lastName>Caller</lastName> <address> <street /> <apartment /> <city /> <state /> <postalCode /> </address> <emailAddress /> <doNotCall>OutOfArea</doNotCall> </caller> <number> <id>8003990537</id> <phoneNumber>8003990537</phoneNumber> <label>Buffalo Autotrader.com</label> <destinationNumber>7169325200</destinationNumber> <brandingName /> <userDefined /> </number> <agent> <code /> <username /> <firstName /> <lastName /> <department /> <store /> <emailAddress /> <voiceNotesUrl /> </agent> <account> <id>21563715</id> <name>Auction Direct USA (New York)</name> <address> <street>6520 State Route 96</street> <apartment /> <city>Victor</city> <state>NY</state> <postalCode>14564</postalCode> </address> <partnerId>3002</partnerId> <provider>Callbright Corporation</provider> <emailAddress>jsherman@auctiondirectusa.com</emailAddress> </account> <store> <id /> <name /> <address> <street /> <apartment /> <city /> <state /> <postalCode /> </address> <emailAddress /> </store> </inboundCall>';
		
		Test.startTest();
		ADFVoice av = new ADFVoice();
		av.parseADF(testCallADF, 'to@email.com');
		av.parseADF(testCallADF, 'auctiondirectinternetadx@dealerteam.com');
		av.alertFailedADF(testCallADF);
		av.parseDateTime('2013-01-01T22:12:01Z');
		Test.stopTest();
	}

	@isTest
	static void testEmailAdfHandler() {
		Messaging.InboundEmail email = new Messaging.Inboundemail();
		Messaging.Inboundenvelope env = new Messaging.Inboundenvelope();
		email.subject = 'Test Sub';
		email.fromname = 'From User'; 
		email.fromAddress = 'from@blackhole.org';
		email.plainTextBody= '<xml>Test</xml>';

		Test.startTest();
		EmailADFHandler emlHandler = new EmailADFHandler(); 
		emlHandler.handleInboundEmail(email, env);
		// System.assertEquals(emlHandler.adfResult, false);
		Test.stopTest();

	}

	@isTest
	static void testEmailAdfVoiceHandler() {
		Messaging.InboundEmail email = new Messaging.Inboundemail();
		Messaging.Inboundenvelope env = new Messaging.Inboundenvelope();
		email.subject = 'Test Sub';
		email.fromname = 'From User';
		email.fromAddress = 'from@blackhole.org';
		email.plainTextBody= '<xml>Test</xml>';

		Test.startTest();
		EmailADFVoiceHandler emlHandler = new EmailADFVoiceHandler();
		emlHandler.handleInboundEmail(email, env);
		Test.stopTest();

	}

	@isTest
	static void testEmailAdfVoiceHandlerBad() {
		Messaging.InboundEmail email = new Messaging.Inboundemail();
		Messaging.Inboundenvelope env = new Messaging.Inboundenvelope();
		email.subject = 'Test Sub';
		email.fromname = 'From User';
		email.fromAddress = 'from@blackhole.org';
		email.plainTextBody= 'bad xml';

		Test.startTest();
		EmailADFVoiceHandler emlHandler = new EmailADFVoiceHandler();
		emlHandler.handleInboundEmail(email, env);
		Test.stopTest();

	}

	@isTest
	static void testADFGeneralHandler() {
		Messaging.InboundEmail email = new Messaging.Inboundemail();
		Messaging.Inboundenvelope env = new Messaging.Inboundenvelope();
		email.subject = 'Test Sub';
		email.fromname = 'From User';
		email.fromAddress = 'from@blackhole.org';
		email.plainTextBody= '<?xml version="1.0"?><formevent> <eventId></eventId> <sessionId></sessionId> <formId>1111</formId> <formName>Test</formName> <contact> <firstName>Jarrett</firstName> <lastName>Kuljis</lastName> <phone></phone> <email></email> <smsoptin></smsoptin> <comments>NoComments</comments> </contact> </formevent>';

		Test.startTest();
		EmailADFGeneralHandler emlHandler = new EmailADFGeneralHandler();
		emlHandler.handleInboundEmail(email, env);		
		Test.stopTest();
	}

	@isTest
	static void testADFGeneralHandlerBad() {
		Messaging.InboundEmail email = new Messaging.Inboundemail();
		Messaging.Inboundenvelope env = new Messaging.Inboundenvelope();
		email.subject = 'Test Sub';
		email.fromname = 'From User';
		email.fromAddress = 'from@blackhole.org';
		email.plainTextBody= 'bad xml';

		Test.startTest();
		EmailADFGeneralHandler emlHandler = new EmailADFGeneralHandler();
		emlHandler.handleInboundEmail(email, env);		
		Test.stopTest();
	}


	@isTest
	static void testUpdateOwner() {

		String testTradeIn1  = '<?xml version="1.0" encoding="utf-8" ?> <?adf version="1.0"?> <adf> <prospect status="new"> <id sequence="1" source="Veretech">1405985457</id> <requestdate>2014-01-31T10:58:53-05:00</requestdate> <vehicle interest="buy" status="used"> <year>2013</year> <make>BMW</make> <model>6-Series</model> <vin></vin> <stocknumber></stocknumber> <trim>2D Coupe</trim> <bodystyle /> <transmission /> <odometer units="mi" /> <colorcombination> <interiorcolor /> <exteriorcolor>UNDECIDED</exteriorcolor> <preference>1</preference> </colorcombination> <price type="quote" currency="USD" source="" /> <pricecomments /> <comments /> </vehicle> <vehicle interest="trade-in" status="used"> <year>2013</year> <make>Mercedes-Benz</make> <model>M Class</model> <vin /> <trim>ML350</trim> <bodystyle>4D Utility</bodystyle> <transmission /> <odometer units="mi">13300</odometer> <colorcombination> <interiorcolor /> <exteriorcolor>White</exteriorcolor> <preference>1</preference> </colorcombination> <price type="quote" currency="USD" source="BlackBookOnline" /> <pricecomments>Price Range: $36,710 - $42,680</pricecomments> <option><optionname>Navigation System</optionname><weighting>0</weighting></option> <option><optionname>Panorama Roof</optionname><weighting>0</weighting></option> <option><optionname>Rearview Camera System</optionname><weighting>0</weighting></option> <option><optionname>w/o Leather</optionname><weighting>0</weighting></option> <comments>Price Range: $36,710 - $42,680 CONDITION REPORT INFO: </comments> </vehicle> <customer> <contact> <name part="full" type="individual">Jason Schmidt</name> <email>dcfilm@aol.com</email> <phone time="morning" type="voice" preferredcontact="0">8082258082</phone> <phone time="evening" type="voice" preferredcontact="0" /> <address type="home"> <street line="1"></street> <street line="2" /> <apartment /> <city>Santa Ana</city> <regioncode>CA</regioncode> <postalcode>92707</postalcode> <country /> </address> </contact> <comments><![CDATA[ CLICK THIS LINK FOR TIPS ON HOW TO GET AN APPOINTMENT <a href="http://www.blackbookinsight.com/dealer">http://www.blackbookinsight.com/dealer </a>EST. TRADE VALUE: $36,710 - $42,680]]> </comments> </customer> <vendor> <id sequence="" source="BlackBookOnline"></id> <vendorname>Auction Direct USA - Jacksonville</vendorname> <contact> <name part="full" type="individual" /> <name part="first" type="individual" /> <name part="last" type="individual" /> <email>testChangeOwnerId@testChangeOwnerId34321.com</email> <phone time="nopreference" type="voice" preferredcontact="0" /> <phone time="nopreference" type="voice" preferredcontact="0" /> <address type="home"> <street line="1">6400 Blanding Boulevard</street> <street line="2"></street> <apartment /> <city>Jacksonville</city> <regioncode>Florida</regioncode> <postalcode>32244</postalcode> <country /> </address> </contact> </vendor> <provider> <id sequence="1" source="BlackBookOnline">561</id> <name part="full" type="business">BlackBookOnline</name> <service>VER</service> <url>http://www.blackbookonline.com</url> <email>support@veretech.com</email> <phone>866-452-1400</phone> <contact> <name part="full" type="individual">Dealer Support</name> <name part="first" type="individual" /> <name part="last" type="individual" /> <email>support@veretech.com</email> <phone time="nopreference" type="voice" preferredcontact="0">866-452-1400</phone> <phone time="nopreference" type="fax" preferredcontact="0">561-544-1450</phone> <address type="work"> <street line="1">150 E. Palmetto Park Road</street> <street line="2">Suite 600</street> <apartment /> <city>Boca Raton</city> <regioncode>FL</regioncode> <postalcode>33432</postalcode> <country>USA</country> </address> </contact> </provider> </prospect> </adf>';


		User u = new User();
		u.ProfileId = [SELECT Id FROM Profile WHERE Name = 'System Administrator'].Id;
		u.LastName = 'last';
		u.Email = 'testChangeOwnerId@testChangeOwnerId34321.com';
		u.Username = 'testChangeOwnerId@testChangeOwnerId34321.com';
		u.CompanyName = 'TEST';
		u.Title = 'title';
		u.Alias = 'alias';
		u.TimeZoneSidKey = 'America/Los_Angeles';
		u.EmailEncodingKey = 'UTF-8';
		u.LanguageLocaleKey = 'en_US';
		u.LocaleSidKey = 'en_US';

		insert u;


		Test.startTest();
			ADFAPI adfP3 = new ADFAPI();
			dealer__CRMSettings__c crm = dealer__CRMSettings__c.getInstance();
			crm.dealer__ILM_No_Duplicates__c=true;
			dealer__Sales_Up__c adf3Res	 =	adfP3.parseADF(testTradeIn1, 'to@address.com', 'fromEmail@address.com');
		Test.stopTest();

		System.assertEquals( u.Id, [ SELECT OwnerId, Id  FROM dealer__Sales_Up__c WHERE Id =: adf3Res.Id ].OwnerId );

	}

	@isTest
	static void testUpdateOwnerQueue() {

		String testTradeIn1  = '<?xml version="1.0" encoding="utf-8" ?> <?adf version="1.0"?> <adf> <prospect status="new"> <id sequence="1" source="Veretech">1405985457</id> <requestdate>2014-01-31T10:58:53-05:00</requestdate> <vehicle interest="buy" status="used"> <year>2013</year> <make>BMW</make> <model>6-Series</model> <vin></vin> <stocknumber></stocknumber> <trim>2D Coupe</trim> <bodystyle /> <transmission /> <odometer units="mi" /> <colorcombination> <interiorcolor /> <exteriorcolor>UNDECIDED</exteriorcolor> <preference>1</preference> </colorcombination> <price type="quote" currency="USD" source="" /> <pricecomments /> <comments /> </vehicle> <vehicle interest="trade-in" status="used"> <year>2013</year> <make>Mercedes-Benz</make> <model>M Class</model> <vin /> <trim>ML350</trim> <bodystyle>4D Utility</bodystyle> <transmission /> <odometer units="mi">13300</odometer> <colorcombination> <interiorcolor /> <exteriorcolor>White</exteriorcolor> <preference>1</preference> </colorcombination> <price type="quote" currency="USD" source="BlackBookOnline" /> <pricecomments>Price Range: $36,710 - $42,680</pricecomments> <option><optionname>Navigation System</optionname><weighting>0</weighting></option> <option><optionname>Panorama Roof</optionname><weighting>0</weighting></option> <option><optionname>Rearview Camera System</optionname><weighting>0</weighting></option> <option><optionname>w/o Leather</optionname><weighting>0</weighting></option> <comments>Price Range: $36,710 - $42,680 CONDITION REPORT INFO: </comments> </vehicle> <customer> <contact> <name part="full" type="individual">Jason Schmidt</name> <email>dcfilm@aol.com</email> <phone time="morning" type="voice" preferredcontact="0">8082258082</phone> <phone time="evening" type="voice" preferredcontact="0" /> <address type="home"> <street line="1"></street> <street line="2" /> <apartment /> <city>Santa Ana</city> <regioncode>CA</regioncode> <postalcode>92707</postalcode> <country /> </address> </contact> <comments><![CDATA[ CLICK THIS LINK FOR TIPS ON HOW TO GET AN APPOINTMENT <a href="http://www.blackbookinsight.com/dealer">http://www.blackbookinsight.com/dealer </a>EST. TRADE VALUE: $36,710 - $42,680]]> </comments> </customer> <vendor> <id sequence="" source="BlackBookOnline"></id> <vendorname>Auction Direct USA - Jacksonville</vendorname> <contact> <name part="full" type="individual" /> <name part="first" type="individual" /> <name part="last" type="individual" /> <email>theQueueName</email> <phone time="nopreference" type="voice" preferredcontact="0" /> <phone time="nopreference" type="voice" preferredcontact="0" /> <address type="home"> <street line="1">6400 Blanding Boulevard</street> <street line="2"></street> <apartment /> <city>Jacksonville</city> <regioncode>Florida</regioncode> <postalcode>32244</postalcode> <country /> </address> </contact> </vendor> <provider> <id sequence="1" source="BlackBookOnline">561</id> <name part="full" type="business">BlackBookOnline</name> <service>VER</service> <url>http://www.blackbookonline.com</url> <email>support@veretech.com</email> <phone>866-452-1400</phone> <contact> <name part="full" type="individual">Dealer Support</name> <name part="first" type="individual" /> <name part="last" type="individual" /> <email>support@veretech.com</email> <phone time="nopreference" type="voice" preferredcontact="0">866-452-1400</phone> <phone time="nopreference" type="fax" preferredcontact="0">561-544-1450</phone> <address type="work"> <street line="1">150 E. Palmetto Park Road</street> <street line="2">Suite 600</street> <apartment /> <city>Boca Raton</city> <regioncode>FL</regioncode> <postalcode>33432</postalcode> <country>USA</country> </address> </contact> </provider> </prospect> </adf>';




		Test.startTest();
			ADFAPI adfP3 = new ADFAPI();
			dealer__CRMSettings__c crm = dealer__CRMSettings__c.getInstance();
			crm.dealer__ILM_No_Duplicates__c=true;
			dealer__Sales_Up__c adf3Res	 =	adfP3.parseADF(testTradeIn1, 'to@address.com', 'fromEmail@address.com');
		Test.stopTest();

		System.assertEquals( [ SELECT Id FROM Group WHERE DeveloperName='theQueueName' ].Id , [ SELECT OwnerId, Id  FROM dealer__Sales_Up__c WHERE Id =: adf3Res.Id ].OwnerId );

	}

	@testSetup
	static void setUpTest() {
		Group testGroup = new Group(Name='theQueueName', Type='Queue', DeveloperName = 'theQueueName' );
		insert testGroup;

		QueuesObject testQueue = new QueueSObject(QueueID = testGroup.id, SObjectType = 'dealer__Sales_Up__c');
		insert testQueue;
	}
}